# Verilog Design For FPGA

## latch
1. 组合逻辑中if语句没有else；  
2. 组合逻辑中case的条件不能够完全列举时且不写default；  
3. 组合逻辑中输出变量赋值给自己。  

## 阻塞赋值与非阻塞赋值
（1）在编写时序逻辑的代码时采用非阻塞赋值的方式   
（2）使用always块来编写组合逻辑的代码时要用阻塞赋值的方式  
（3）在同一个always块中不要既要用非阻塞赋值又用阻塞方式赋值  
（4）虽然锁存器电路建模是我们不推荐的，但是如果使用到要采用非阻塞赋值的方
式。   
使用非阻塞赋值实现时序逻辑，实现锁存器是最为安全的。  
（5）一个always块只一个变量进行赋值  

## 状态机 FSM（Finite State Machine）

## 互联网

### OSI模型

为了实现网络通信的标准化，普及网络应用，国际标准化组织(ISO)将整个以太网通信
结构制定了 OSI (Open System Interconnection)模型，译为开放式系统互联。 
OSI 定义了网络互连的七层框架（物理层、数据链路层、网络层、传输层、会话层、
表示层、应用层），即 OSI 开放互连系统参考模型。每个层功能不同，网络通信中各司其
职，整个模型包括硬件和软件定义。 OSI 模型只是是理想分层，一般的网络系统只是涉及
其中几层。OSI参考模型，具体见图  
![alt text](image.png)  
应用层：OSI 参考模型中最靠近用户的一层，为计算机用户提供应用接口和各种网
络服务。主要协议：HTTP，HTTPS，FTP，POP3、SMTP、SNMP、DHCP、
DNS。  
 表示层：表示层提供各种用于应用层数据的编码和转换功能，确保一个系统的应用
层发送的数据能被另一个系统的应用层识别。如果必要，该层可提供一种标准表
示形式，用于将计算机内部的多种数据格式转换成通信中采用的标准表示形式。
同时，数据压缩和加密也是表示层可提供的转换功能之一。主要格式：JPEG、
ASCll、DECOIC、加密格式。  
 会话层：会话层就是负责建立、管理和终止表示层实体之间的通信会话。该层的通
信由不同设备中的应用程序之间的服务请求和响应组成。 
 传输层：传输层的作用是为上层协议提供端到端的可靠和透明的数据传输服务，包
括处理差错控制和流量控制等问题。该层向高层屏蔽了下层数据通信的细节，使
高层用户看到的只是在两个传输实体间的一条主机到主机的、可由用户控制和设
定的、可靠的数据通路。主要协议TCP、UDP。  
 网络层：网络层通过 IP 寻址来建立两个节点之间的连接，为源端的运输层送来的
分组，选择合适的路由和交换节点，正确无误地按照地址传送给目的端的传输
层，就是我们常说的IP层。主要协议：ICMP IGMP IP（IPV4 IPV6）。 
 数据链路层：实现比特到字节再到帧的组合，使用链路层地址 (以太网使用 MAC
地址)来访问介质，并进行差错检测。数据链路层又分为 2个子层：逻辑链路控制
子层（LLC）和媒体访问控制子层（MAC）。 MAC 子层处理 CSMA/CD 算法、
数据出错校验、成帧等；LLC 子层定义了一些字段使上次协议能共享数据链路
层。 在实际使用中，LLC 子层并非必需的。主要协议 ARP、RARP、
IEEE802.3、PPP、CSMA/CD。  
 物理层：最终信号的传输是通过物理层实现的，通过物理介质传输比特流。规定了
电平、速度和电缆针脚。常用设备：集线器、中继器、调制解调器、网线、双绞
线、同轴电缆等。  

### TCP/IP 五层模型

。TCP/IP（Transmission Control 
Protocol/Internet Protocol，传输控制协议/网际协议）是指能够在多个不同网络间实现信息
传输的协议簇。TCP/IP 协议不仅仅指的是 TCP 和 IP 两个协议，而是指一个由 FTP、
SMTP、TCP、UDP、IP 等协议构成的协议簇， 只是因为在 TCP/IP协议中 TCP协议和 IP
协议最具代表性，所以被称为TCP/IP协议。 
在 TCP/IP 协议中，OSI 七层参考模型被简化为五层。在 TCP/IP 五层模型中，将提供
服务类似的应用层、表示层、会话层合并为应用层一个层次，其他层次不变。TCP/IP 五层
模型，具体见图  
![alt text](image-1.png)  
在 TCP/IP 五层参考模型中，数据链路层又被分为 LLC 层(逻辑链路层)和 MAC 层(媒
体介质访问层)。目前，对于普通的接入网络终端的设备， LLC 层和 MAC 层是软、硬件的
分界线。如 PC 的网卡主要负责实现参考模型中的 MAC 子层和物理层，在 PC 的软件系统
中则有一套庞大程序实现了 LLC 层及以上的所有网络层次的协议  

### 以太网
以太网是指遵守 IEEE 802.3 标准组成的局域网，由 IEEE 802.3 标准规定的主要是位于
参考模型的物理层(PHY)和数据链路层中的介质访问控制子层(MAC)。在家庭、企业和学
校所组建的 PC 局域网形式一般也是以太网，其标志是使用水晶头网线来连接(当然还有其
它形式)。 IEEE 还有其它局域网标准，如 IEEE 802.11 是无线局域网，俗称 Wi-Fi。 
IEEE802.15 是个人域网，即蓝牙技术，其中的 802.15.4 标准则是 ZigBee 技术。 
现阶段，工业控制、环境监测、智能家居的嵌入式设备产生了接入互联网的需求，利
用以太网技术，嵌入式设备可以非常容易地接入到现有的计算机网络中。  

1. **物理层** 
在物理层，由 IEEE 802.3 标准规定了以太网使用的传输介质、传输速度、数据编码方
式和冲突检测机制，物理层一般是通过一个 PHY 芯片实现其功能的。 
**传输介质**   
传输介质包括同轴电缆、双绞线(水晶头网线是一种双绞线)、光纤。根据不同的传输
速度和距离要求，基于这三类介质的信号线又衍生出很多不同的种类。最常用的是“五类
线”、“超五类线”和“六类线”，五类网线通常用于传输百兆网速，超五类网线、六类网
线除了能够传输百兆网速之外，还能够传输千兆网速。五类网线在使用千兆光纤时，只能达到百兆网速的传输速度，超五类、六类网线如果只开通了百兆的光纤，同样也只能产生
百兆网速的传输效果。六类网线和五类网线、超五类网线比起来在串扰和回波损耗方面的
性能得到了很大改善。五类网线外表皮的标识是 CAT5，超五类网线外表皮的标识是
CAT5E，六类网线的标识则是CAT6。  
**编码**   
为了让接收方在没有外部时钟参考的情况也能确定每一位的起始、结束和中间位置，
在传输信号时不直接采用二进制编码。在 10BASE-T 的传输方式中采用曼彻斯特编码，在
100BASE-T 中则采用 4B/5B 编码，在1000BASE-T 中则采用 5电平4D-PAM编码。曼彻斯
特编码把每一个二进制位的周期分为两个间隔，在表示“ 1”时，以前半个周期为高电平，
后半个周期为低电平。表示“ 0”时则相反，见图  
![alt text](image-2.png)  
采用曼彻斯特码在每个位周期都有电压变化，便于同步。但这样的编码方式效率太
低，只有 50%。在 100BASE-T 采用的 4B/5B 编码是把待发送数据位流的每 4 位分为一
组，以特定的 5位编码来表示，这些特定的 5 位编码能使数据流有足够多的跳变，达到同
步的目的，而且效率也从曼彻斯特编码的 50%提高到了 80%。 
1000BASE-T 在使用 5电平 4D-PAM编码，每个电平表示 5符号-2、-1、0、1、2中的
一个符号，每个符号代表2比特信息（其中4电平中每个电平代表2比特，分别表示00、
01、10、11，还有一个电平表示向前纠错码 FEC），这比二电平编码提高了带宽利用率，
并能把波特率和所需信号带宽减为原来的一半。数据速率为125Mb/s，每个Baud波特码元
代表两个比特信息，四对线的总带宽为125Mb/s * 2 * 4 = 1000Mb/s。 
**CSMA/CD 冲突检测**  
早期的以太网大多是多个节点连接到同一条网络总线上(总线型网络)，存在信道竞争
问题，因而每个连接到以太网上的节点都必须具备冲突检测功能。以太网具备 CSMA/CD
冲突检测机制，如果多个节点同时利用同一条总线发送数据，则会产生冲突，总线上的节
点可通过接收到的信号与原始发送的信号的比较检测是否存在冲突，若存在冲突则停止发
送数据，随机等待一段时间再重传。现在大多数局域网组建的时候很少采用总线型网络，大多是一个设备接入到一个独立的路由或交换机接口，组成星型网络，不会产生冲突。但
为了兼容，新出的产品还是带有冲突检测机制。   
**MII/RGMII 接口**  
MII （Media Independent Interface（介质无关接口）或称为媒体独立接口，它是IEEE
802.3 定义的以太网行业标准，用以连接以太网 MAC 层和 PHY 芯片，后逐步扩展为：
MII、RMII、SMII、GMII、RGMII等。 
MII：百兆以太网接口，单边沿采样。 
RMII：百兆以太网接口，MII的线路简化版，双边沿采样。 
GMII：千兆以太网接口，单边沿采样。 
RGMII：千兆以太网接口，GMII的线路简化版，双边沿采样。 
MII通信需要13根线，GMII需要20根线，而RGMII只需 12根通信，RGMII在功能
上实现千兆以太网，信号线却大大减少。图1为 GMII 接口连接示意图，图2为 
RGMII 接口连接示意图。
![1](image-3.png)  
![2](image-4.png)  
 TX_CLK：数据发送时钟线。标称传输速率为 10Mbit/s 时为 2.5MHz；速率为 
100Mbit/s 时为 25MHz，速率为1000Mbit/s时为125M。  
 TX_CTL：数据发送控制使能。在整个数据发送过程保持有效电平。 
 TXD[7:0]或 TXD[3:0]：数据发送数据线。对于 GMII 有 8位，在时钟上升沿采样， 
RGMII 只有 4 位，在时钟双边沿采样。只有在TX_CTL 处于有效电平数据线才有
效。 
 RX_CLK：数据接收时钟线。由 PHY 芯片负责驱动。标称传输速率为 10Mbit/s 时
为 2.5MHz；速率为 100Mbit/s 时为 25MHz，速率为1000Mbit/s时为125M。 
 RX_CTL：接收数据有效信号，功能类似 TX_CTL，只不过用于数据接收，由 PHY 
芯片负责驱动。 
 RXD[7:0]或 RXD[3:0]：数据接收数据线，由 PHY 芯片负责驱动。对于 GMII 有 8 
位，RGMII 只有 4 位。只有在RX_CTL 处于有效电平数据线才有效。 
此外在以太网接口中还有一些比较重要的接口，虽然本实验没有用到，但有必要了解
一下。 
 RX_ER：接收错误信号线，由 PHY 驱动，向 MAC 控制器报告在帧某处检测到错
误。 
 CRS：载波侦听信号，由 PHY 芯片负责驱动，当发送或接收介质处于非空闲状态
时使能该信号。在全双工模式该信号线无效。  
 COL：冲突检测信号，由 PHY 芯片负责驱动，检测到介质上存在冲突后该线被使
能，并且保持至冲突解除。在全双工模式该信号线无效。 
 REF_CLK：仅用于 RMII 接口，由外部时钟源提供 50MHz 参考时钟。 
因为要达到 100Mbit/s 传输速度， MII 和 RMII 数据线数量不同，使用 MII 和 
RMII 在时钟线的设计是完全不同的。对于 MII 接口，一般是外部为 PHY 提供 
25MHz 时钟源，再由 PHY 提供 TX_CLK 和 RX_CLK 时钟。对于 RMII 接口，一
般需要外部直接提供 50MHz时钟源，同时接入 MAC 和 PHY。 
 MDC：SMI 串行管理接口的时钟信号，它是一个非周期信号，信号的最小周期
（实际是正电平时间和负电平时间之和）为 400ns，最小正电平时间和负电平时
间为 160ns，最大的正负电平时间无限制。它与 TX_CLK 和 RX_CLK 无任何关
系。 
 MDIO：SMI 串行管理接口的数据信号，MDIO 是一根双向的数据线，用来传送
MAC 层的控制信息和物理层的状态信息。MDIO 数据与 MDC 时钟同步，在
MDC上升沿有效。  


